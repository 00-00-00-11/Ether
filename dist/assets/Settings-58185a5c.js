var J=Object.defineProperty;var j=(a,e,t)=>e in a?J(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var c=(a,e,t)=>(j(a,typeof e!="symbol"?e+"":e,t),t);import{Z as F,D as h,T as b,s as S,a as y,r as E,b as f,c as L,d as w,L as _,e as $,g as K,f as B,h as A,i as O,j as N,k as x}from"./index-8b22cbfa.js";class v{constructor({wrapperEl:e,updateState:t,getState:s,id:n}){c(this,"wrapperEl");c(this,"updateState");c(this,"getState");c(this,"id");this.wrapperEl=e,this.updateState=t.bind(this),this.getState=s,this.id=n}render(){const e=this.getState(),t=this.wrapperEl.querySelectorAll(".input-wrapper"),s=Object.entries(e);for(let n=0;n<s.length&&!(!t[n]||!s[n]);n++){const r=t[n].querySelector("label"),i=t[n].querySelector("input"),[o,l]=s[n],d=`${this.id}-${o.replace(" ","-")}`;r.textContent=o,r.setAttribute("for",d),i.id=d,i.name=o,i.value=l,i.addEventListener("input",this.updateState)}}rerender(){const e=this.getState(),t=this.wrapperEl.querySelectorAll(".input-wrapper"),s=Object.entries(e);for(let n=0;n<s.length&&!(!t[n]||!s[n]);n++){const r=t[n].querySelector("input"),[,i]=s[n];r.value=i}}}function k(a){return a&&typeof a=="object"&&a.constructor===Object}function I(a){return Array.isArray(a)&&a.every(e=>k(e))}function g(a){for(const e of Object.keys(a))typeof a[e]=="string"?a[e]=a[e].trim():k(a[e])?g(a[e]):I(a[e])&&a[e].forEach(t=>g(t))}class T{constructor({title:e,state:t,sectionEl:s,onSave:n,render:r,rerender:i}){c(this,"title");c(this,"state");c(this,"_defaultState");c(this,"sectionEl");c(this,"onSave");c(this,"render");c(this,"rerender");this.title=e,this.state=t,this._defaultState=JSON.parse(JSON.stringify(t)),this.sectionEl=s,this.onSave=n,this.rerender=i,this.render=r}save(){try{this.state&&k(this.state)?g(this.state):typeof this.state=="string"?this.state=this.state.trim():I(this.state)&&this.state.forEach(e=>g(e)),this.onSave(this.state),this._defaultState=this.state,this.displaySuccessMsg(),this.sectionEl.classList.remove("error"),this.rerender()}catch(e){const t=e;if(e instanceof F){let s="";e.issues.forEach(n=>s+=`
${n.message}`),this.displayFailedMsg(s)}else t.message==="The quota has been exceeded."?this.displayFailedMsg("The image is too large."):this.displayFailedMsg(t.message||void 0);this.sectionEl.classList.add("error")}}displayFailedMsg(e){const t=this.sectionEl.querySelector(".msg");e=e||"failed, localStorage is turned off or full",h.displayMsg(t,e)}hideMsg(){this.sectionEl.querySelector(".msg").classList.add("hide")}displaySuccessMsg(){const e=this.sectionEl.querySelector(".msg");h.displayMsg(e,`successfully saved your ${this.title}`),setTimeout(()=>{e.classList.add("hide")},3e3)}reset(){this.state=JSON.parse(JSON.stringify(this._defaultState)),this.sectionEl.querySelector(".msg").classList.add("hide"),this.sectionEl.classList.remove("error")}}class p extends T{constructor({title:t,state:s,sectionEl:n,children:r=[],onSave:i}){super({title:t,state:s,sectionEl:n,onSave:i,render:()=>{},rerender:()=>{}});c(this,"title");c(this,"state");c(this,"_defaultState");c(this,"sectionEl");c(this,"children");c(this,"onSave");this.title=t,this.state=s,this._defaultState=JSON.parse(JSON.stringify(s)),this.sectionEl=n,this.children=r,this.onSave=i,this.render=function(){var l;this.children.forEach(d=>{Array.isArray(this.state),d.render()}),(l=this.sectionEl.querySelector("button[type='submit']"))==null||l.addEventListener("click",d=>{d.preventDefault(),this.save()});const o=this.sectionEl.querySelector("button[aria-label='reset']");o==null||o.addEventListener("click",()=>{this.reset(),this.rerender()})},this.rerender=function(){this.children.forEach(o=>{Array.isArray(this.state),o.rerender()})}}}function D(a,e){const t=new p({title:"theme",state:a,sectionEl:document.getElementById("theme-settings"),children:[{render:function(){const s=document.querySelector("#theme-settings select");s.value="custom";for(const n of Object.keys(b)){const r=h.option({text:n,value:n});s.append(r),s.addEventListener("change",()=>{const i=b[s.value];S(i.theme),y(i.image),E(),f(),t.state=i.theme,e.state=i.image,t.rerender(),e.rerender()})}},rerender:()=>{}},new v({wrapperEl:document.querySelector("#theme-settings .input-group"),updateState:s=>{const n=document.querySelector("#theme-settings select");n.value="custom";const r=s.target,i=r.name;i==="panel opacity"?t.state[i]=Number(r.value):t.state[i]=r.value},getState:()=>t.state,id:"theme"})],onSave:()=>{S(t.state),f()}});return t}class G{constructor({wrapperEl:e,updateLink:t,updateTitle:s,getState:n,id:r}){c(this,"wrapperEl");c(this,"updateTitle");c(this,"updateLink");c(this,"children");c(this,"getState");c(this,"id");this.wrapperEl=e,this.updateLink=t,this.updateTitle=s,this.getState=n,this.id=r;const i=this.wrapperEl.querySelectorAll(".link-details");this.children=Array.from(i).map((o,l)=>new v({wrapperEl:o,updateState:d=>{t(d,l)},getState:()=>n().links[l],id:this.id+"-"+l.toString()}))}render(){const e=this.getState(),t=this.wrapperEl.querySelector("header input");t.value=e.title,t.addEventListener("input",o=>{this.updateTitle(o),this.rerender()});const s=this.wrapperEl.querySelector("header span.link-group-title");s.textContent=e.title;const n=this.wrapperEl.querySelector("header .edit-button"),r=o=>{var l,d;o.stopPropagation(),(l=this.wrapperEl.querySelector(".display-mode"))==null||l.classList.toggle("hide"),(d=this.wrapperEl.querySelector(".edit-mode"))==null||d.classList.toggle("hide")};n==null||n.addEventListener("click",r);const i=this.wrapperEl.querySelector("header .done-button");i==null||i.addEventListener("click",o=>{r(o)}),this.children.forEach(o=>o.render())}rerender(){const e=this.getState(),t=this.wrapperEl.querySelector("header input");t.value=e.title;const s=this.wrapperEl.querySelector("header span.link-group-title");s.textContent=e.title,this.children.forEach(n=>n.rerender())}}function q(a,e,t=document){let s=t.querySelectorAll(e);if(s.length!==a)for(;s.length!=a;){let n;s.length>a?n=s[s.length-1].remove:n=()=>{var r;(r=s[0].parentElement)==null||r.append(s[0].cloneNode(!0))},n(),s=t.querySelectorAll(e)}}function R(a){q(_,"form[name='links'] > ul .link-group"),document.querySelectorAll("form[name='links'] > ul .link-group").forEach(s=>q($,".link-details",s)),document.querySelectorAll("form[name='links'] > ul .link-group > header").forEach(s=>s.addEventListener("click",function(r){const o=r.currentTarget.nextElementSibling,l=s.querySelector(".display-mode");l!=null&&l.classList.contains("hide")||(o.classList.toggle("accordion"),s.classList.toggle("accordion-closed"))}));const t=new p({title:"links",state:a,sectionEl:document.getElementById("link-settings"),children:[...Array.from(document.querySelectorAll("#link-settings .link-group")).map((s,n)=>new G({wrapperEl:s,updateLink:(r,i)=>{const o=r.target;t.state[n].links[i][o.name]=o.value},updateTitle:r=>{const i=r.target;a[n].title=i.value},getState:()=>t.state[n],id:"group-"+n.toString()}))],onSave:()=>{L(t.state),w()}});return t}function U(a){const e=new p({title:"keybinds",state:a,sectionEl:document.getElementById("keybind-settings"),children:[{render:function(){var n;const t=document.getElementById("keybind-settings"),s=t.querySelector("#keybind-settings textarea");s.value=JSON.stringify(a,null,2),s.addEventListener("input",r=>{const i=r.target;try{e.state=JSON.parse(i.value),e.hideMsg(),e.sectionEl.classList.remove("error")}catch{e.sectionEl.classList.add("error"),e.displayFailedMsg("Invalid json")}}),(n=t.querySelector("button[data-role='generate keybinds']"))==null||n.addEventListener("click",()=>{const r=K();if(!r)return;const i=B(r);e.state=i,this.rerender()})},rerender:()=>{const t=document.querySelector("#keybind-settings textarea");t.value=JSON.stringify(e.state,null,2)}}],onSave:()=>{A(e.state),O()}});return e}function C(a){const e=new p({title:"image",state:a,sectionEl:document.getElementById("image-settings"),children:[function(){return{render:function(){const s=document.getElementById("image-settings");s.querySelector("input[type='file']").addEventListener("change",r=>{const i=r.target;if(!i.files)return;const o=i.files[0];function l(){const u=o.name.match(/\.[0-9a-z]+$/i);return u&&[".jpg",".png",".webp",".gif",".svg"].includes(u[0])}try{if(!l())throw new Error("Not a valid image")}catch(u){const m=u;e.displayFailedMsg(m.message)}const d=new FileReader;d.addEventListener("load",()=>{const u=s.querySelector("label .button-text");u.textContent=o.name,e.state.image=`url(${d.result})`}),d.readAsDataURL(o)})},rerender:function(){const n=document.getElementById("image-settings").querySelector("label .button-text");n.textContent="Choose your image"}}}(),new v({wrapperEl:document.querySelector("#image-settings .input-group"),updateState:t=>{const s=t.target,n=s.name;n!=="image"&&(e.state[n]=s.value)},getState:()=>{const t={...e.state};return delete t.image,t},id:"a"})],onSave:t=>{y(t),E()}});return e}function P(){const a=new T({title:"json",sectionEl:document.querySelector("#json-settings"),state:"",render:function(){var n;const e=document.querySelector("#json-settings"),t=e==null?void 0:e.querySelector("form[name='import json'] textarea");t.value=this.state,t==null||t.addEventListener("input",r=>{const i=r.target;this.state=i.value}),(n=this.sectionEl.querySelector("button[type='submit']"))==null||n.addEventListener("click",r=>{r.preventDefault(),this.save()});const s=this.sectionEl.querySelector("button[aria-label='reset']");s==null||s.addEventListener("click",()=>{this.reset(),this.rerender()})},rerender:function(){const e=document.querySelector("#json-settings"),t=e==null?void 0:e.querySelector("form[name='import json'] textarea");t.value=a.state},onSave:function(){const e=this.state.replace(/[\n\r]+/g,""),t=JSON.parse(e);for(const[s,n]of Object.entries(t))switch(s){case"theme":{S(n),f();break}case"links":{L(n),w();break}case"image":{y(n),E();break}case"keybinds":{A(n),O();break}case"search":{N(n),x();break}default:throw new Error(`${s} is an invalid option`)}}});return a}const W={getAll:function(){const a=JSON.parse(JSON.stringify(localStorage));for(const e of Object.keys(a))a[e]=JSON.parse(a[e]);return a},format:function(){return JSON.stringify(this.getAll(),null,2)}},Z=W;function z(a){return{render:function(){var t;Array.isArray(this.children)?this.children.forEach(s=>s.render()):(t=this.children)==null||t.render()},rerender:function(){var t;Array.isArray(this.children)?this.children.forEach(s=>s.rerender()):(t=this.children)==null||t.rerender()},children:[function(){return{title:"search",state:a,sectionEl:document.getElementById("misc-settings"),render:function(){var r;const s=(r=this.sectionEl)==null?void 0:r.querySelector("select[name='search-engine']");s.addEventListener("change",i=>{const o=i.target;N(o.value),x()}),s.querySelectorAll("option").forEach(i=>{i.value===this.state&&i.setAttribute("selected","true")})},rerender:function(){var r;((r=this.sectionEl)==null?void 0:r.querySelector("select[name='search-engine']")).querySelectorAll("option").forEach(i=>{i.value===this.state&&i.setAttribute("selected","true")})}}}(),function(){return{render:()=>{const s=document.getElementById("misc-settings"),n=s==null?void 0:s.querySelector("a[data-role='reset to defaults']");n==null||n.addEventListener("click",()=>{localStorage.clear(),location.reload()});const r=s==null?void 0:s.querySelector("a[data-role='copy config']");r==null||r.addEventListener("click",i=>{var l;i.preventDefault(),navigator.clipboard.writeText(Z.format());const o=(l=r==null?void 0:r.parentElement)==null?void 0:l.querySelector(".msg");h.displayMsg(o,"your config has been copied to your clipboard"),setTimeout(()=>{o.classList.add("hide")},3e3)})},rerender:()=>{}}}()]}}function V({links:a,theme:e,keybinds:t,imageState:s,search:n}){const r=R(a),i=U(t),o=C(s),l=D(e,o),d=z(n),u=P();[l,r,i,o,d,u].forEach(M=>M.render())}export{V as default};
