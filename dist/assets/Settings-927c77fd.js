var M=Object.defineProperty;var j=(i,e,t)=>e in i?M(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var c=(i,e,t)=>(j(i,typeof e!="symbol"?e+"":e,t),t);import{Z as F,D as h,T as b,s as m,a as y,r as E,b as f,c as L,d as w,L as _,e as $,g as K,f as A,h as O,i as N,j as x}from"./index-9ff0de73.js";class v{constructor({wrapperEl:e,updateState:t,getState:s,id:n}){c(this,"wrapperEl");c(this,"updateState");c(this,"getState");c(this,"id");this.wrapperEl=e,this.updateState=t.bind(this),this.getState=s,this.id=n}render(){const e=this.getState(),t=this.wrapperEl.querySelectorAll(".input-wrapper"),s=Object.entries(e);for(let n=0;n<s.length&&!(!t[n]||!s[n]);n++){const r=t[n].querySelector("label"),a=t[n].querySelector("input"),[o,l]=s[n],d=`${this.id}-${o.replace(" ","-")}`;r.textContent=o,r.setAttribute("for",d),a.id=d,a.name=o,a.value=l,a.addEventListener("input",this.updateState)}}rerender(){const e=this.getState(),t=this.wrapperEl.querySelectorAll(".input-wrapper"),s=Object.entries(e);for(let n=0;n<s.length&&!(!t[n]||!s[n]);n++){const r=t[n].querySelector("input"),[,a]=s[n];r.value=a}}}function k(i){return i&&typeof i=="object"&&i.constructor===Object}function I(i){return Array.isArray(i)&&i.every(e=>k(e))}function g(i){for(const e of Object.keys(i))typeof i[e]=="string"?i[e]=i[e].trim():k(i[e])?g(i[e]):I(i[e])&&i[e].forEach(t=>g(t))}class T{constructor({title:e,state:t,sectionEl:s,onSave:n,render:r,rerender:a}){c(this,"title");c(this,"state");c(this,"_defaultState");c(this,"sectionEl");c(this,"onSave");c(this,"render");c(this,"rerender");this.title=e,this.state=t,this._defaultState=JSON.parse(JSON.stringify(t)),this.sectionEl=s,this.onSave=n,this.rerender=a,this.render=r}save(){try{this.state&&k(this.state)?g(this.state):typeof this.state=="string"?this.state=this.state.trim():I(this.state)&&this.state.forEach(e=>g(e)),this.onSave(this.state),this._defaultState=this.state,this.displaySuccessMsg(),this.sectionEl.classList.remove("error"),this.rerender()}catch(e){const t=e;if(e instanceof F){let s="";e.issues.forEach(n=>s+=`
${n.message}`),this.displayFailedMsg(s)}else t.message==="The quota has been exceeded."?this.displayFailedMsg("The image is too large."):this.displayFailedMsg(t.message||void 0);this.sectionEl.classList.add("error")}}displayFailedMsg(e){const t=this.sectionEl.querySelector(".msg");e=e||"failed, localStorage is turned off or full",h.displayMsg(t,e)}hideMsg(){this.sectionEl.querySelector(".msg").classList.add("hide")}displaySuccessMsg(){const e=this.sectionEl.querySelector(".msg");h.displayMsg(e,`successfully saved your ${this.title}`),setTimeout(()=>{e.classList.add("hide")},3e3)}reset(){this.state=JSON.parse(JSON.stringify(this._defaultState)),this.sectionEl.querySelector(".msg").classList.add("hide"),this.sectionEl.classList.remove("error")}}class p extends T{constructor({title:t,state:s,sectionEl:n,children:r=[],onSave:a}){super({title:t,state:s,sectionEl:n,onSave:a,render:()=>{},rerender:()=>{}});c(this,"title");c(this,"state");c(this,"_defaultState");c(this,"sectionEl");c(this,"children");c(this,"onSave");this.title=t,this.state=s,this._defaultState=JSON.parse(JSON.stringify(s)),this.sectionEl=n,this.children=r,this.onSave=a,this.render=function(){var l;this.children.forEach(d=>{Array.isArray(this.state),d.render()}),(l=this.sectionEl.querySelector("button[type='submit']"))==null||l.addEventListener("click",d=>{d.preventDefault(),this.save()});const o=this.sectionEl.querySelector("button[aria-label='reset']");o==null||o.addEventListener("click",()=>{this.reset(),this.rerender()})},this.rerender=function(){this.children.forEach(o=>{Array.isArray(this.state),o.rerender()})}}}function B(i,e){const t=new p({title:"theme",state:i,sectionEl:document.getElementById("theme-settings"),children:[{render:function(){const s=document.querySelector("#theme-settings select");s.value="custom";for(const n of Object.keys(b)){const r=h.option({text:n,value:n});s.append(r),s.addEventListener("change",()=>{const a=b[s.value];m(a.theme),y(a.image),E(),f(),t.state=a.theme,e.state=a.image,t.rerender(),e.rerender()})}},rerender:()=>{}},new v({wrapperEl:document.querySelector("#theme-settings .input-group"),updateState:s=>{const n=document.querySelector("#theme-settings select");n.value="custom";const r=s.target,a=r.name;a==="panel opacity"?t.state[a]=Number(r.value):t.state[a]=r.value},getState:()=>t.state,id:"theme"})],onSave:()=>{m(t.state),f()}});return t}class D{constructor({wrapperEl:e,updateLink:t,updateTitle:s,getState:n,id:r}){c(this,"wrapperEl");c(this,"updateTitle");c(this,"updateLink");c(this,"children");c(this,"getState");c(this,"id");this.wrapperEl=e,this.updateLink=t,this.updateTitle=s,this.getState=n,this.id=r;const a=this.wrapperEl.querySelectorAll(".link-details");this.children=Array.from(a).map((o,l)=>new v({wrapperEl:o,updateState:d=>{t(d,l)},getState:()=>n().links[l],id:this.id+"-"+l.toString()}))}render(){const e=this.getState(),t=this.wrapperEl.querySelector("header input");t.value=e.title,t.addEventListener("input",o=>{this.updateTitle(o),this.rerender()});const s=this.wrapperEl.querySelector("header span.link-group-title");s.textContent=e.title;const n=this.wrapperEl.querySelector("header .edit-button"),r=o=>{var l,d;o.stopPropagation(),(l=this.wrapperEl.querySelector(".display-mode"))==null||l.classList.toggle("hide"),(d=this.wrapperEl.querySelector(".edit-mode"))==null||d.classList.toggle("hide")};n==null||n.addEventListener("click",r);const a=this.wrapperEl.querySelector("header .done-button");a==null||a.addEventListener("click",o=>{r(o)}),this.children.forEach(o=>o.render())}rerender(){const e=this.getState(),t=this.wrapperEl.querySelector("header input");t.value=e.title;const s=this.wrapperEl.querySelector("header span.link-group-title");s.textContent=e.title,this.children.forEach(n=>n.rerender())}}function q(i,e,t=document){let s=t.querySelectorAll(e);if(s.length!==i)for(;s.length!=i;){let n;s.length>i?n=s[s.length-1].remove:n=()=>{var r;(r=s[0].parentElement)==null||r.append(s[0].cloneNode(!0))},n(),s=t.querySelectorAll(e)}}function G(i){q(_,"form[name='links'] > ul .link-group"),document.querySelectorAll("form[name='links'] > ul .link-group").forEach(s=>q($,".link-details",s)),document.querySelectorAll("form[name='links'] > ul .link-group > header").forEach(s=>s.addEventListener("click",function(r){const o=r.currentTarget.nextElementSibling,l=s.querySelector(".display-mode");l!=null&&l.classList.contains("hide")||(o.classList.toggle("accordion"),s.classList.toggle("accordion-closed"))}));const t=new p({title:"links",state:i,sectionEl:document.getElementById("link-settings"),children:[...Array.from(document.querySelectorAll("#link-settings .link-group")).map((s,n)=>new D({wrapperEl:s,updateLink:(r,a)=>{const o=r.target;t.state[n].links[a][o.name]=o.value},updateTitle:r=>{const a=r.target;i[n].title=a.value},getState:()=>t.state[n],id:"group-"+n.toString()}))],onSave:()=>{L(t.state),w()}});return t}function R(i){const e=new p({title:"keybinds",state:i,sectionEl:document.getElementById("keybind-settings"),children:[{render:function(){var n;const t=document.getElementById("keybind-settings"),s=t.querySelector("#keybind-settings textarea");s.value=JSON.stringify(i,null,2),s.addEventListener("input",r=>{const a=r.target;try{e.state=JSON.parse(a.value),e.hideMsg(),e.sectionEl.classList.remove("error")}catch{e.sectionEl.classList.add("error"),e.displayFailedMsg("Invalid json")}}),(n=t.querySelector("button[data-role='generate keybinds']"))==null||n.addEventListener("click",()=>{const r=JSON.parse(localStorage.getItem("links")||"");if(!r)return;const a=K(r);e.state=a,this.rerender()})},rerender:()=>{const t=document.querySelector("#keybind-settings textarea");t.value=JSON.stringify(i,null,2)}}],onSave:()=>{A(e.state),O()}});return e}function U(i){const e=new p({title:"image",state:i,sectionEl:document.getElementById("image-settings"),children:[function(){return{render:function(){const s=document.getElementById("image-settings");s.querySelector("input[type='file']").addEventListener("change",r=>{const a=r.target;if(!a.files)return;const o=a.files[0];function l(){const u=o.name.match(/\.[0-9a-z]+$/i);return u&&[".jpg",".png",".webp",".gif",".svg"].includes(u[0])}try{if(!l())throw new Error("Not a valid image")}catch(u){const S=u;e.displayFailedMsg(S.message)}const d=new FileReader;d.addEventListener("load",()=>{const u=s.querySelector("label .button-text");u.textContent=o.name,e.state.image=`url(${d.result})`}),d.readAsDataURL(o)})},rerender:function(){const n=document.getElementById("image-settings").querySelector("label .button-text");n.textContent="Choose your image"}}}(),new v({wrapperEl:document.querySelector("#image-settings .input-group"),updateState:t=>{const s=t.target,n=s.name;n!=="image"&&(e.state[n]=s.value)},getState:()=>{const t={...e.state};return delete t.image,t},id:"a"})],onSave:t=>{y(t),E()}});return e}function C(){const i=new T({title:"json",sectionEl:document.querySelector("#json-settings"),state:"",render:function(){var n;const e=document.querySelector("#json-settings"),t=e==null?void 0:e.querySelector("form[name='import json'] textarea");t.value=this.state,t==null||t.addEventListener("input",r=>{const a=r.target;this.state=a.value}),(n=this.sectionEl.querySelector("button[type='submit']"))==null||n.addEventListener("click",r=>{r.preventDefault(),this.save()});const s=this.sectionEl.querySelector("button[aria-label='reset']");s==null||s.addEventListener("click",()=>{this.reset(),this.rerender()})},rerender:function(){const e=document.querySelector("#json-settings"),t=e==null?void 0:e.querySelector("form[name='import json'] textarea");t.value=i.state},onSave:function(){const e=this.state.replace(/[\n\r]+/g,""),t=JSON.parse(e);for(const[s,n]of Object.entries(t))switch(s){case"theme":{m(n),f();break}case"links":{L(n),w();break}case"image":{y(n),E();break}case"keybinds":{A(n),O();break}case"search":{N(n),x();break}default:throw new Error(`${s} is an invalid option`)}}});return i}const P={getAll:function(){const i=JSON.parse(JSON.stringify(localStorage));for(const e of Object.keys(i))i[e]=JSON.parse(i[e]);return i},format:function(){return JSON.stringify(this.getAll(),null,2)}},W=P;function Z(i){return{render:function(){var t;Array.isArray(this.children)?this.children.forEach(s=>s.render()):(t=this.children)==null||t.render()},rerender:function(){var t;Array.isArray(this.children)?this.children.forEach(s=>s.rerender()):(t=this.children)==null||t.rerender()},children:[function(){return{title:"search",state:i,sectionEl:document.getElementById("misc-settings"),render:function(){var r;const s=(r=this.sectionEl)==null?void 0:r.querySelector("select[name='search-engine']");s.addEventListener("change",a=>{const o=a.target;N(o.value),x()}),s.querySelectorAll("option").forEach(a=>{a.value===this.state&&a.setAttribute("selected","true")})},rerender:function(){var r;((r=this.sectionEl)==null?void 0:r.querySelector("select[name='search-engine']")).querySelectorAll("option").forEach(a=>{a.value===this.state&&a.setAttribute("selected","true")})}}}(),function(){return{render:()=>{const s=document.getElementById("misc-settings"),n=s==null?void 0:s.querySelector("a[data-role='reset to defaults']");n==null||n.addEventListener("click",()=>{localStorage.clear(),location.reload()});const r=s==null?void 0:s.querySelector("a[data-role='copy config']");r==null||r.addEventListener("click",a=>{var l;a.preventDefault(),navigator.clipboard.writeText(W.format());const o=(l=r==null?void 0:r.parentElement)==null?void 0:l.querySelector(".msg");h.displayMsg(o,"your config has been copied to your clipboard"),setTimeout(()=>{o.classList.add("hide")},3e3)})},rerender:()=>{}}}()]}}function Q({links:i,theme:e,keybinds:t,imageState:s,search:n}){const r=G(i),a=R(t),o=U(s),l=B(e,o),d=Z(n),u=C();[l,r,a,o,d,u].forEach(J=>J.render())}export{Q as default};
